<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>نظام متابعة طلبات المواطنين - عضو مجلس النواب</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --electricity-color: #f97316;
            --health-color: #ec4899;
            --water-color: #0ea5e9;
            --sanitation-color: #8b5cf6;
            --education-color: #84cc16;
            --transport-color: #6366f1;
            --telecom-color: #06b6d4;
            --housing-color: #14b8a6;
            --vh: 1vh;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow-x: hidden;
            transition: all 0.3s;
            font-size: 16px;
            line-height: 1.5;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
        }
        
        /* شاشة الترحيب */
        .welcome-screen {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .welcome-logo {
            font-size: 60px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        
        .welcome-title {
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .welcome-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .welcome-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        /* صفحة المصادقة */
        .auth-page {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 15px;
        }
        
        .auth-container {
            width: 100%;
            max-width: 450px;
        }
        
        .auth-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .auth-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .auth-body {
            padding: 25px;
        }
        
        /* التطبيق الرئيسي */
        .app-content {
            display: none;
            background-color: #f8fafc;
            min-height: 100vh;
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, #1e40af 100%);
            min-height: 100vh;
            color: white;
            position: fixed;
            width: 250px;
            z-index: 1000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.8);
            padding: 12px 15px;
            margin: 5px 10px;
            border-radius: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            min-height: 44px;
        }
        
        .nav-link:hover, .nav-link.active {
            background-color: rgba(255, 255, 255, 0.15);
            color: white;
        }
        
        .main-content {
            margin-right: 250px;
            padding: 15px;
            min-height: 100vh;
        }
        
        /* تحسينات للجوال */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar-header h3,
            .nav-link span {
                display: none;
            }
            
            .main-content {
                margin-right: 70px;
            }
            
            .nav-link {
                justify-content: center;
                padding: 15px;
                margin: 5px;
            }
            
            .nav-link i {
                margin-left: 0;
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 768px) {
            .welcome-title {
                font-size: 24px;
            }
            
            .welcome-subtitle {
                font-size: 14px;
            }
            
            .welcome-buttons {
                flex-direction: column;
                width: 100%;
                max-width: 300px;
            }
            
            .welcome-buttons .btn {
                width: 100%;
            }
            
            .auth-card {
                margin: 10px;
            }
            
            .main-content {
                padding: 10px;
                margin-right: 70px;
            }
            
            .card {
                margin-bottom: 15px;
            }
            
            .card-header {
                padding: 0.75rem 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .table-responsive {
                border: 0;
            }
            
            .table-responsive table {
                min-width: 600px;
            }
            
            .stats-number {
                font-size: 1.75rem;
            }
            
            h5, h6 {
                font-size: 1.1rem;
            }
        }
        
        @media (max-width: 576px) {
            .sidebar {
                width: 60px;
            }
            
            .main-content {
                margin-right: 60px;
            }
            
            .nav-link {
                padding: 12px;
                margin: 3px;
            }
            
            .auth-page {
                padding: 10px;
            }
            
            .auth-header {
                padding: 20px;
            }
            
            .auth-body {
                padding: 20px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 14px;
            }
            
            .form-control, .form-select {
                font-size: 16px !important;
                padding: 12px;
            }
        }
        
        /* تحسينات للشاشات التي تعمل باللمس */
        @media (hover: none) and (pointer: coarse) {
            .btn, .nav-link, .category-card {
                min-height: 44px;
            }
            
            .nav-link:hover {
                transform: none;
            }
            
            .stat-card:hover {
                transform: none;
            }
        }
        
        /* بطاقات الإحصائيات */
        .stat-card {
            border-radius: 12px;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        /* الحالات والفئات */
        .status-badge, .category-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .status-submitted { background-color: #dbeafe; color: var(--primary-color); }
        .status-pending { background-color: #fef3c7; color: var(--warning-color); }
        .status-approved { background-color: #d1fae5; color: var(--success-color); }
        .status-rejected { background-color: #fee2e2; color: var(--danger-color); }
        
        .category-electricity { background-color: #ffedd5; color: var(--electricity-color); border-right: 4px solid var(--electricity-color); }
        .category-health { background-color: #fce7f3; color: var(--health-color); border-right: 4px solid var(--health-color); }
        .category-water { background-color: #e0f2fe; color: var(--water-color); border-right: 4px solid var(--water-color); }
        .category-sanitation { background-color: #f3e8ff; color: var(--sanitation-color); border-right: 4px solid var(--sanitation-color); }
        .category-education { background-color: #f0fdf4; color: var(--education-color); border-right: 4px solid var(--education-color); }
        .category-transport { background-color: #eef2ff; color: var(--transport-color); border-right: 4px solid var(--transport-color); }
        .category-telecom { background-color: #ecfeff; color: var(--telecom-color); border-right: 4px solid var(--telecom-color); }
        .category-housing { background-color: #f0fdfa; color: var(--housing-color); border-right: 4px solid var(--housing-color); }
        
        /* زر الإضافة العائم */
        .add-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.4);
            z-index: 100;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.6);
        }
        
        @media (max-width: 768px) {
            .add-btn {
                width: 50px;
                height: 50px;
                bottom: 16px;
                left: 16px;
            }
            
            .add-btn:active {
                transform: scale(0.95);
            }
        }
        
        /* تحسينات النماذج */
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 15px;
            border: 2px solid #e5e7eb;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }
        
        /* تحسينات الجداول */
        .table th {
            font-weight: 600;
            background-color: #f8f9fa;
        }
        
        /* تحسينات البحث */
        .search-container {
            position: relative;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1050;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        
        @media (max-width: 768px) {
            .search-results {
                position: fixed;
                top: auto;
                right: 10px;
                left: 10px;
                max-height: 50vh;
                z-index: 9999;
            }
            
            .search-container .input-group {
                flex-direction: column;
            }
            
            .search-container .input-group > * {
                width: 100% !important;
                border-radius: 8px !important;
                margin-bottom: 5px;
            }
        }
        
        /* تحسينات التمرير */
        .scrollable {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
        
        /* تحسينات الرسوم البيانية */
        .chart-container {
            position: relative;
            height: 250px;
        }
        
        @media (max-width: 768px) {
            .chart-container {
                height: 200px;
            }
        }
        
        /* تحسينات عامة */
        .user-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin: 0 auto 15px;
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* إخفاء التمرير في بعض المتصفحات */
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* تحسينات للأداء على الجوال */
        @media (max-width: 768px) {
            .animate-slide-in {
                animation: none;
            }
        }
    </style>
</head>
<body>
    <!-- شاشة الترحيب -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-logo">
            <i class="fas fa-hands-helping"></i>
        </div>
        <h1 class="welcome-title">نظام متابعة طلبات المواطنين</h1>
        <p class="welcome-subtitle">عضو مجلس النواب</p>
        <div class="welcome-buttons">
            <button class="btn btn-light btn-lg" id="loginWelcomeBtn">
                <i class="fas fa-sign-in-alt me-2"></i>تسجيل الدخول
            </button>
            <button class="btn btn-outline-light btn-lg" id="registerWelcomeBtn">
                <i class="fas fa-user-plus me-2"></i>إنشاء حساب جديد
            </button>
        </div>
    </div>

    <!-- صفحة تسجيل الدخول -->
    <div id="loginPage" class="auth-page" style="display: none;">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h1>تسجيل الدخول</h1>
                    <p>نظام متابعة طلبات المواطنين</p>
                </div>
                <div class="auth-body">
                    <div id="loginAlert" class="alert alert-danger d-none"></div>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">اسم المستخدم</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">كلمة المرور</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" required>
                                <button type="button" class="btn btn-outline-secondary" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">تسجيل الدخول</button>
                        <div class="text-center mt-3">
                            <a href="#" id="showRegisterLink" class="text-decoration-none">إنشاء حساب جديد</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- صفحة إنشاء حساب -->
    <div id="registerPage" class="auth-page" style="display: none;">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-header">
                    <h1>إنشاء حساب جديد</h1>
                    <p>انضم إلى نظام متابعة طلبات المواطنين</p>
                </div>
                <div class="auth-body">
                    <div id="registerAlert" class="alert alert-danger d-none"></div>
                    <form id="registerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الاسم الكامل</label>
                                <input type="text" class="form-control" id="fullName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم المستخدم</label>
                                <input type="text" class="form-control" id="regUsername" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">كلمة المرور</label>
                                <input type="password" class="form-control" id="regPassword" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">تأكيد كلمة المرور</label>
                                <input type="password" class="form-control" id="confirmPassword" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">إنشاء حساب</button>
                        <div class="text-center mt-3">
                            <a href="#" id="showLoginLink" class="text-decoration-none">لديك حساب بالفعل؟ تسجيل الدخول</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- التطبيق الرئيسي -->
    <div id="appContent" class="app-content" style="display: none;">
        <!-- الشريط الجانبي -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="text-center">
                        <div id="sidebarUserName" class="fw-bold">عضو مجلس النواب</div>
                        <small id="sidebarUserRole" class="text-white-50">المسؤول</small>
                    </div>
                </div>
            </div>
            <ul class="nav flex-column mt-3">
                <li class="nav-item"><a class="nav-link active" href="#dashboard"><i class="fas fa-tachometer-alt"></i><span>لوحة التحكم</span></a></li>
                <li class="nav-item"><a class="nav-link" href="#requests"><i class="fas fa-list"></i><span>جميع الطلبات</span></a></li>
                <li class="nav-item"><a class="nav-link" href="#search"><i class="fas fa-search"></i><span>بحث متقدم</span></a></li>
                <li class="nav-item"><a class="nav-link" href="#categories"><i class="fas fa-layer-group"></i><span>الهيئات الحكومية</span></a></li>
                <li class="nav-item"><a class="nav-link" href="#reports"><i class="fas fa-chart-bar"></i><span>التقارير</span></a></li>
                <li class="nav-item"><a class="nav-link" href="#profile"><i class="fas fa-user-circle"></i><span>الملف الشخصي</span></a></li>
            </ul>
            <div class="mt-auto p-3">
                <button class="btn btn-outline-light w-100" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="d-none d-lg-inline">تسجيل الخروج</span>
                </button>
            </div>
        </nav>

        <!-- المحتوى الرئيسي -->
        <main class="main-content">
            <!-- لوحة التحكم -->
            <section id="dashboard" class="page-section">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4 class="mb-0">لوحة التحكم</h4>
                    <button class="btn btn-primary" id="newRequestBtn">
                        <i class="fas fa-plus me-2"></i>طلب جديد
                    </button>
                </div>

                <!-- الإحصائيات -->
                <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stat-icon bg-primary text-white me-3">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="totalRequests">0</h5>
                                        <small class="text-muted">إجمالي الطلبات</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stat-icon bg-success text-white me-3">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="approvedRequests">0</h5>
                                        <small class="text-muted">تمت الموافقة</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stat-icon bg-warning text-white me-3">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="pendingRequests">0</h5>
                                        <small class="text-muted">قيد الانتظار</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <div class="stat-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stat-icon bg-danger text-white me-3">
                                        <i class="fas fa-times-circle"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="rejectedRequests">0</h5>
                                        <small class="text-muted">مرفوضة</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- الطلبات الأخيرة -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">الطلبات الأخيرة</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>اسم مقدم الطلب</th>
                                        <th>الهيئة</th>
                                        <th>الحالة</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="recentRequests">
                                    <!-- البيانات تضاف بالجافاسكريبت -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- جميع الطلبات -->
            <section id="requests" class="page-section" style="display: none;">
                <h4 class="mb-4">جميع الطلبات</h4>
                <div class="card">
                    <div class="card-body">
                        <div id="allRequestsList">
                            <!-- البيانات تضاف بالجافاسكريبت -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- البحث المتقدم -->
            <section id="search" class="page-section" style="display: none;">
                <h4 class="mb-4">بحث متقدم</h4>
                <div class="card">
                    <div class="card-body">
                        <form id="searchForm">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">اسم مقدم الطلب</label>
                                    <input type="text" class="form-control" id="searchName">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">الهيئة</label>
                                    <select class="form-select" id="searchCategory">
                                        <option value="">كل الهيئات</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">بحث</button>
                        </form>
                        <div class="mt-4" id="searchResults"></div>
                    </div>
                </div>
            </section>

            <!-- الهيئات الحكومية -->
            <section id="categories" class="page-section" style="display: none;">
                <h4 class="mb-4">الهيئات الحكومية</h4>
                <div class="row" id="categoriesGrid">
                    <!-- البيانات تضاف بالجافاسكريبت -->
                </div>
            </section>

            <!-- التقارير -->
            <section id="reports" class="page-section" style="display: none;">
                <h4 class="mb-4">التقارير</h4>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-chart-pie fa-3x text-primary mb-3"></i>
                                <h5>تقرير التوزيع</h5>
                                <button class="btn btn-outline-primary mt-2">تحميل</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                                <h5>تقرير الأداء</h5>
                                <button class="btn btn-outline-success mt-2">تحميل</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- الملف الشخصي -->
            <section id="profile" class="page-section" style="display: none;">
                <h4 class="mb-4">الملف الشخصي</h4>
                <div class="card">
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="user-avatar mx-auto">
                                <i class="fas fa-user"></i>
                            </div>
                            <h4 id="profileName">عضو مجلس النواب</h4>
                            <p id="profileRole" class="text-muted">المسؤول</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- زر الإضافة العائم -->
        <button class="add-btn" id="floatingAddBtn" style="display: none;">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- مكتبات JavaScript -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // بيانات التطبيق
        const categories = {
            'electricity': { name: 'كهرباء', color: '#f97316', icon: 'fas fa-bolt' },
            'health': { name: 'صحة', color: '#ec4899', icon: 'fas fa-hospital' },
            'water': { name: 'مياه', color: '#0ea5e9', icon: 'fas fa-tint' },
            'education': { name: 'تعليم', color: '#84cc16', icon: 'fas fa-graduation-cap' },
            'transport': { name: 'مواصلات', color: '#6366f1', icon: 'fas fa-bus' }
        };

        const statuses = {
            'submitted': { name: 'تم التقديم', color: '#3b82f6', icon: 'fas fa-file-import' },
            'pending': { name: 'انتظار الرد', color: '#f59e0b', icon: 'fas fa-clock' },
            'approved': { name: 'موافقة', color: '#10b981', icon: 'fas fa-check-circle' },
            'rejected': { name: 'غير موافقة', color: '#ef4444', icon: 'fas fa-times-circle' }
        };

        let requests = JSON.parse(localStorage.getItem('requests')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser'));

        // تهيئة التطبيق
        $(document).ready(function() {
            initViewportHeight();
            initUsers();
            setupEventListeners();
            checkAuth();
            setupMobileOptimizations();
        });

        // ضبط ارتفاع viewport للجوال
        function initViewportHeight() {
            function setViewportHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }
            window.addEventListener('resize', setViewportHeight);
            setViewportHeight();
        }

        // تهيئة المستخدمين
        function initUsers() {
            if (!localStorage.getItem('users')) {
                const users = [
                    {
                        id: 1,
                        username: 'admin',
                        password: 'admin123',
                        fullName: 'عضو مجلس النواب',
                        role: 'admin'
                    },
                    {
                        id: 2,
                        username: 'user',
                        password: 'user123',
                        fullName: 'مساعد عضو',
                        role: 'user'
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        // إعداد المستشعرات
        function setupEventListeners() {
            // شاشة الترحيب
            $('#loginWelcomeBtn').click(() => showPage('login'));
            $('#registerWelcomeBtn').click(() => showPage('register'));

            // تسجيل الدخول
            $('#loginForm').submit(handleLogin);
            $('#showRegisterLink').click(() => showPage('register'));
            $('#togglePassword').click(togglePasswordVisibility);

            // التسجيل
            $('#registerForm').submit(handleRegister);
            $('#showLoginLink').click(() => showPage('login'));

            // التطبيق الرئيسي
            $('#logoutBtn').click(handleLogout);
            $('#newRequestBtn, #floatingAddBtn').click(showNewRequestModal);
            
            // التنقل
            $('.nav-link').click(function(e) {
                e.preventDefault();
                const page = $(this).attr('href').substring(1);
                showAppPage(page);
            });

            // البحث
            $('#searchForm').submit(handleSearch);
        }

        // تحسينات الجوال
        function setupMobileOptimizations() {
            // تحسين أداء التمرير
            document.documentElement.style.setProperty('--webkit-overflow-scrolling', 'touch');
            
            // منع التكبير على حقول الإدخال
            $('input, select, textarea').on('focus', function() {
                $(this).css('font-size', '16px');
            });
        }

        // التحقق من المصادقة
        function checkAuth() {
            if (currentUser) {
                startApp();
            } else {
                showPage('welcome');
            }
        }

        // عرض الصفحة
        function showPage(page) {
            $('.welcome-screen, .auth-page, .app-content').hide();
            $(`#${page}Page, #${page}Screen, #${page}Content`).show();
        }

        // تسجيل الدخول
        function handleLogin(e) {
            e.preventDefault();
            const username = $('#username').val();
            const password = $('#password').val();
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                startApp();
                showAlert('تم تسجيل الدخول بنجاح', 'success');
            } else {
                showAlert('اسم المستخدم أو كلمة المرور غير صحيحة', 'error');
            }
        }

        // التسجيل
        function handleRegister(e) {
            e.preventDefault();
            const fullName = $('#fullName').val();
            const username = $('#regUsername').val();
            const password = $('#regPassword').val();
            const confirmPassword = $('#confirmPassword').val();

            if (password !== confirmPassword) {
                showAlert('كلمات المرور غير متطابقة', 'error');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users'));
            if (users.some(u => u.username === username)) {
                showAlert('اسم المستخدم موجود مسبقاً', 'error');
                return;
            }

            const newUser = {
                id: users.length + 1,
                username,
                password,
                fullName,
                role: 'user'
            };

            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            showAlert('تم إنشاء الحساب بنجاح', 'success');
            showPage('login');
        }

        // تشغيل التطبيق
        function startApp() {
            showPage('app');
            updateUserInfo();
            loadDashboard();
            setupCategories();
        }

        // تحديث معلومات المستخدم
        function updateUserInfo() {
            if (currentUser) {
                $('#sidebarUserName').text(currentUser.fullName);
                $('#sidebarUserRole').text(currentUser.role === 'admin' ? 'المسؤول' : 'المستخدم');
                $('#profileName').text(currentUser.fullName);
                $('#profileRole').text(currentUser.role === 'admin' ? 'المسؤول' : 'المستخدم');
            }
        }

        // تحميل لوحة التحكم
        function loadDashboard() {
            updateStats();
            loadRecentRequests();
        }

        // تحديث الإحصائيات
        function updateStats() {
            $('#totalRequests').text(requests.length);
            $('#approvedRequests').text(requests.filter(r => r.status === 'approved').length);
            $('#pendingRequests').text(requests.filter(r => r.status === 'pending').length);
            $('#rejectedRequests').text(requests.filter(r => r.status === 'rejected').length);
        }

        // تحميل الطلبات الأخيرة
        function loadRecentRequests() {
            const recent = requests.slice(0, 5);
            const tbody = $('#recentRequests');
            tbody.empty();

            recent.forEach(request => {
                const category = categories[request.category];
                const status = statuses[request.status];
                
                tbody.append(`
                    <tr>
                        <td>${request.id}</td>
                        <td>${request.applicantName}</td>
                        <td><span class="category-badge ${getCategoryClass(request.category)}">
                            <i class="${category.icon} me-1"></i>${category.name}
                        </span></td>
                        <td><span class="status-badge ${getStatusClass(request.status)}">
                            ${status.name}
                        </span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="viewRequest(${request.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `);
            });
        }

        // إعداد الفئات
        function setupCategories() {
            const select = $('#searchCategory');
            select.empty();
            select.append('<option value="">كل الهيئات</option>');
            
            Object.entries(categories).forEach(([key, cat]) => {
                select.append(`<option value="${key}">${cat.name}</option>`);
            });

            // إعداد شبكة الهيئات
            const grid = $('#categoriesGrid');
            Object.entries(categories).forEach(([key, cat]) => {
                const count = requests.filter(r => r.category === key).length;
                grid.append(`
                    <div class="col-md-4 col-6 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <div class="stat-icon mx-auto mb-3" style="background-color: ${cat.color}; color: white;">
                                    <i class="${cat.icon}"></i>
                                </div>
                                <h5>${cat.name}</h5>
                                <p class="text-muted">${count} طلب</p>
                            </div>
                        </div>
                    </div>
                `);
            });
        }

        // البحث
        function handleSearch(e) {
            e.preventDefault();
            const name = $('#searchName').val().toLowerCase();
            const category = $('#searchCategory').val();

            let results = requests;
            if (name) {
                results = results.filter(r => r.applicantName.toLowerCase().includes(name));
            }
            if (category) {
                results = results.filter(r => r.category === category);
            }

            displaySearchResults(results);
        }

        // عرض نتائج البحث
        function displaySearchResults(results) {
            const container = $('#searchResults');
            container.empty();

            if (results.length === 0) {
                container.html('<p class="text-center text-muted">لا توجد نتائج</p>');
                return;
            }

            results.forEach(request => {
                const category = categories[request.category];
                const status = statuses[request.status];
                
                container.append(`
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6>${request.applicantName}</h6>
                                    <p class="text-muted mb-2">${request.requestTitle}</p>
                                    <div>
                                        <span class="category-badge ${getCategoryClass(request.category)} me-2">
                                            <i class="${category.icon}"></i> ${category.name}
                                        </span>
                                        <span class="status-badge ${getStatusClass(request.status)}">
                                            ${status.name}
                                        </span>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="viewRequest(${request.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `);
            });
        }

        // عرض نموذج طلب جديد
        function showNewRequestModal() {
            const modalHtml = `
                <div class="modal fade" id="newRequestModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">طلب جديد</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="requestForm">
                                    <div class="mb-3">
                                        <label class="form-label">اسم مقدم الطلب</label>
                                        <input type="text" class="form-control" id="applicantName" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">عنوان الطلب</label>
                                        <input type="text" class="form-control" id="requestTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">تفاصيل الطلب</label>
                                        <textarea class="form-control" id="requestDetails" rows="3" required></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">الهيئة</label>
                                        <select class="form-select" id="requestCategory" required>
                                            <option value="">اختر الهيئة</option>
                                            ${Object.entries(categories).map(([key, cat]) => 
                                                `<option value="${key}">${cat.name}</option>`
                                            ).join('')}
                                        </select>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                                <button type="button" class="btn btn-primary" onclick="saveRequest()">حفظ</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            $('body').append(modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('newRequestModal'));
            modal.show();

            $('#newRequestModal').on('hidden.bs.modal', function() {
                $(this).remove();
            });
        }

        // حفظ الطلب الجديد
        function saveRequest() {
            const newRequest = {
                id: requests.length > 0 ? Math.max(...requests.map(r => r.id)) + 1 : 1,
                applicantName: $('#applicantName').val(),
                requestTitle: $('#requestTitle').val(),
                requestDetails: $('#requestDetails').val(),
                category: $('#requestCategory').val(),
                status: 'pending',
                date: new Date().toISOString().split('T')[0]
            };

            requests.unshift(newRequest);
            localStorage.setItem('requests', JSON.stringify(requests));
            
            $('#newRequestModal').modal('hide');
            showAlert('تم إضافة الطلب بنجاح', 'success');
            loadDashboard();
        }

        // عرض الطلب
        function viewRequest(id) {
            const request = requests.find(r => r.id === id);
            if (!request) return;

            const category = categories[request.category];
            const status = statuses[request.status];

            const modalHtml = `
                <div class="modal fade" id="viewRequestModal">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">تفاصيل الطلب #${request.id}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <strong>اسم مقدم الطلب:</strong>
                                        <p>${request.applicantName}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>التاريخ:</strong>
                                        <p>${request.date}</p>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <strong>الهيئة:</strong>
                                        <p><span class="category-badge ${getCategoryClass(request.category)}">
                                            <i class="${category.icon} me-1"></i>${category.name}
                                        </span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>الحالة:</strong>
                                        <p><span class="status-badge ${getStatusClass(request.status)}">
                                            ${status.name}
                                        </span></p>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <strong>عنوان الطلب:</strong>
                                    <p>${request.requestTitle}</p>
                                </div>
                                <div class="mb-3">
                                    <strong>تفاصيل الطلب:</strong>
                                    <p>${request.requestDetails}</p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">تحديث الحالة</label>
                                    <select class="form-select" id="updateStatus">
                                        ${Object.entries(statuses).map(([key, stat]) => 
                                            `<option value="${key}" ${request.status === key ? 'selected' : ''}>${stat.name}</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                                <button type="button" class="btn btn-primary" onclick="updateRequestStatus(${request.id})">حفظ التغييرات</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            $('body').append(modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('viewRequestModal'));
            modal.show();

            $('#viewRequestModal').on('hidden.bs.modal', function() {
                $(this).remove();
            });
        }

        // تحديث حالة الطلب
        function updateRequestStatus(id) {
            const newStatus = $('#updateStatus').val();
            const request = requests.find(r => r.id === id);
            
            if (request) {
                request.status = newStatus;
                localStorage.setItem('requests', JSON.stringify(requests));
                $('#viewRequestModal').modal('hide');
                showAlert('تم تحديث حالة الطلب', 'success');
                loadDashboard();
            }
        }

        // تسجيل الخروج
        function handleLogout() {
            if (confirm('هل تريد تسجيل الخروج؟')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                showPage('welcome');
                showAlert('تم تسجيل الخروج', 'success');
            }
        }

        // عرض الصفحة في التطبيق
        function showAppPage(page) {
            $('.page-section').hide();
            $(`#${page}`).show();
            $('.nav-link').removeClass('active');
            $(`.nav-link[href="#${page}"]`).addClass('active');

            // إظهار/إخفاء زر الإضافة العائم
            if (page === 'dashboard' || page === 'requests') {
                $('#floatingAddBtn').show();
            } else {
                $('#floatingAddBtn').hide();
            }

            // تحميل محتوى الصفحة
            switch(page) {
                case 'requests':
                    loadAllRequests();
                    break;
                case 'reports':
                    loadReports();
                    break;
            }
        }

        // تحميل جميع الطلبات
        function loadAllRequests() {
            const container = $('#allRequestsList');
            container.empty();

            if (requests.length === 0) {
                container.html('<p class="text-center text-muted">لا توجد طلبات</p>');
                return;
            }

            requests.forEach(request => {
                const category = categories[request.category];
                const status = statuses[request.status];
                
                container.append(`
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">${request.requestTitle}</h6>
                                    <p class="text-muted small mb-2">${request.applicantName} - ${request.date}</p>
                                    <div>
                                        <span class="category-badge ${getCategoryClass(request.category)} me-2">
                                            <i class="${category.icon}"></i> ${category.name}
                                        </span>
                                        <span class="status-badge ${getStatusClass(request.status)}">
                                            ${status.name}
                                        </span>
                                    </div>
                                </div>
                                <div class="ms-3">
                                    <button class="btn btn-sm btn-outline-primary" onclick="viewRequest(${request.id})">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `);
            });
        }

        // تحميل التقارير
        function loadReports() {
            // يمكن إضافة منطق التقارير هنا
        }

        // دوال مساعدة
        function togglePasswordVisibility() {
            const input = $('#password');
            const icon = $('#togglePassword i');
            if (input.attr('type') === 'password') {
                input.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                input.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        }

        function showAlert(message, type) {
            const alertClass = type === 'error' ? 'alert-danger' : 'alert-success';
            const alertHtml = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed"
                     style="top: 20px; left: 20px; right: 20px; z-index: 9999;">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            $('body').append(alertHtml);
            setTimeout(() => $('.alert').alert('close'), 3000);
        }

        function getCategoryClass(category) {
            return `category-${category}`;
        }

        function getStatusClass(status) {
            return `status-${status}`;
        }

        // تعريف الدوال للاستخدام العام
        window.viewRequest = viewRequest;
        window.updateRequestStatus = updateRequestStatus;
        window.saveRequest = saveRequest;
    </script>
</body>
</html>
