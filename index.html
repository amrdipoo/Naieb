<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام متابعة طلبات المواطنين - عضو مجلس النواب</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .auth-page {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, #1e40af 100%);
            min-height: 100vh;
            width: 250px;
            position: fixed;
            color: white;
        }
        
        .main-content {
            margin-right: 250px;
            padding: 20px;
            min-height: 100vh;
        }
        
        .stat-card {
            border-radius: 10px;
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .category-badge {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            border-right: 3px solid;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            .main-content {
                margin-right: 70px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="auth-page">
        <div class="auth-card p-4">
            <div class="text-center mb-4">
                <i class="fas fa-hands-helping fa-3x text-primary mb-3"></i>
                <h3>نظام متابعة طلبات المواطنين</h3>
                <p class="text-muted">عضو مجلس النواب</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">اسم المستخدم</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">كلمة المرور</label>
                    <div class="input-group">
                        <input type="password" class="form-control" id="password" required>
                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-sign-in-alt me-2"></i>تسجيل الدخول
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="p-3">
                <h5 class="text-white mb-4">نظام الطلبات</h5>
                
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link text-white active" href="#" data-page="dashboard">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            <span>لوحة التحكم</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#" data-page="requests">
                            <i class="fas fa-list me-2"></i>
                            <span>جميع الطلبات</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#" data-page="newRequest">
                            <i class="fas fa-plus-circle me-2"></i>
                            <span>طلب جديد</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#" data-page="githubSync">
                            <i class="fab fa-github me-2"></i>
                            <span>GitHub Sync</span>
                        </a>
                    </li>
                </ul>
                
                <div class="mt-4">
                    <button class="btn btn-outline-light w-100" id="logoutBtn">
                        <i class="fas fa-sign-out-alt me-2"></i>
                        <span>تسجيل الخروج</span>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div id="dashboardPage">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h4>لوحة التحكم</h4>
                    <button class="btn btn-primary" id="addRequestBtn">
                        <i class="fas fa-plus me-2"></i>طلب جديد
                    </button>
                </div>
                
                <!-- Stats -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card border-start-primary border-start-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">إجمالي الطلبات</h6>
                                        <h4 id="totalRequests">0</h4>
                                    </div>
                                    <div class="bg-primary text-white rounded p-3">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card border-start-success border-start-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">طلبات جديدة</h6>
                                        <h4 id="newRequests">0</h4>
                                    </div>
                                    <div class="bg-success text-white rounded p-3">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card border-start-warning border-start-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">قيد الانتظار</h6>
                                        <h4 id="pendingRequests">0</h4>
                                    </div>
                                    <div class="bg-warning text-white rounded p-3">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-3 mb-3">
                        <div class="card stat-card border-start-info border-start-4">
                            <div class="card-body">
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <h6 class="text-muted">نسبة الإنجاز</h6>
                                        <h4 id="completionRate">0%</h4>
                                    </div>
                                    <div class="bg-info text-white rounded p-3">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Requests Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">الطلبات الأخيرة</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>اسم مقدم الطلب</th>
                                        <th>الرقم القومي</th>
                                        <th>الهيئة</th>
                                        <th>الحالة</th>
                                        <th>التاريخ</th>
                                        <th>الإجراءات</th>
                                    </tr>
                                </thead>
                                <tbody id="requestsTable">
                                    <!-- سيتم تعبئتها جافاسكريبت -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GitHub Sync Page -->
            <div id="githubSyncPage" style="display: none;">
                <div class="card">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0"><i class="fab fa-github me-2"></i>GitHub Sync</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">GitHub Token</label>
                                    <input type="password" class="form-control" id="githubToken" 
                                           placeholder="أدخل GitHub Personal Access Token">
                                    <small class="text-muted">
                                        أنشئ Token من GitHub Settings → Developer settings → Personal access tokens
                                    </small>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">اسم المستودع</label>
                                    <input type="text" class="form-control" id="githubRepo" 
                                           value="citizen-requests-system" placeholder="اسم المستودع">
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">اسم الملف</label>
                                    <input type="text" class="form-control" id="githubFilename" 
                                           value="data.json" placeholder="اسم الملف">
                                </div>
                                
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="autoSync">
                                    <label class="form-check-label">المزامنة التلقائية عند التغيير</label>
                                </div>
                                
                                <div class="d-flex gap-2">
                                    <button class="btn btn-primary" id="saveGithubConfig">
                                        <i class="fas fa-save me-2"></i>حفظ الإعدادات
                                    </button>
                                    <button class="btn btn-outline-primary" id="testGithubConnection">
                                        <i class="fas fa-plug me-2"></i>اختبار الاتصال
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card border-primary">
                                    <div class="card-header bg-primary text-white">
                                        <h6 class="mb-0">المزامنة اليدوية</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted mb-3">
                                            قم بمزامنة بيانات الطلبات مع GitHub يدوياً
                                        </p>
                                        
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-success" id="syncToGithubBtn">
                                                <i class="fas fa-upload me-2"></i>رفع البيانات إلى GitHub
                                            </button>
                                            <button class="btn btn-info" id="syncFromGithubBtn">
                                                <i class="fas fa-download me-2"></i>جلب البيانات من GitHub
                                            </button>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <h6>حالة المزامنة الأخيرة</h6>
                                            <div id="syncStatus" class="alert alert-info">
                                                <i class="fas fa-info-circle me-2"></i>
                                                لم تتم أي مزامنة بعد
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="newRequestModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">إضافة طلب جديد</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newRequestForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الرقم القومي</label>
                                <input type="text" class="form-control" id="nationalId" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم مقدم الطلب</label>
                                <input type="text" class="form-control" id="applicantName" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">رقم الهاتف</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">العنوان</label>
                                <input type="text" class="form-control" id="address" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">عنوان الطلب</label>
                            <input type="text" class="form-control" id="requestTitle" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">وصف الطلب</label>
                            <textarea class="form-control" id="requestSummary" rows="3" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">الهيئة الحكومية</label>
                                <select class="form-select" id="category" required>
                                    <option value="">اختر الهيئة...</option>
                                    <option value="electricity">كهرباء</option>
                                    <option value="health">صحة</option>
                                    <option value="water">مياه</option>
                                    <option value="sanitation">صرف صحي</option>
                                    <option value="education">تعليم</option>
                                    <option value="transport">مواصلات</option>
                                    <option value="telecom">اتصالات</option>
                                    <option value="housing">إسكان</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">أولوية الطلب</label>
                                <select class="form-select" id="priority" required>
                                    <option value="low">منخفض</option>
                                    <option value="medium" selected>متوسط</option>
                                    <option value="high">عاجل</option>
                                </select>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="submitRequestBtn">حفظ الطلب</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // بيانات النظام
        const systemData = {
            categories: {
                electricity: { name: 'كهرباء', color: '#f97316', icon: 'fas fa-bolt' },
                health: { name: 'صحة', color: '#ec4899', icon: 'fas fa-hospital' },
                water: { name: 'مياه', color: '#0ea5e9', icon: 'fas fa-tint' },
                sanitation: { name: 'صرف صحي', color: '#8b5cf6', icon: 'fas fa-toilet' },
                education: { name: 'تعليم', color: '#84cc16', icon: 'fas fa-graduation-cap' },
                transport: { name: 'مواصلات', color: '#6366f1', icon: 'fas fa-bus' },
                telecom: { name: 'اتصالات', color: '#06b6d4', icon: 'fas fa-wifi' },
                housing: { name: 'إسكان', color: '#14b8a6', icon: 'fas fa-home' }
            },
            statuses: {
                submitted: { name: 'تم التقديم', color: '#3b82f6', icon: 'fas fa-file-import' },
                pending: { name: 'انتظار الرد', color: '#f59e0b', icon: 'fas fa-clock' },
                approved: { name: 'موافقة', color: '#10b981', icon: 'fas fa-check-circle' },
                rejected: { name: 'غير موافقة', color: '#ef4444', icon: 'fas fa-times-circle' }
            }
        };

        // بيانات التطبيق
        let requests = JSON.parse(localStorage.getItem('citizenRequests')) || [
            {
                id: 1001,
                nationalId: "29801011234567",
                applicantName: "أحمد محمد علي",
                requestTitle: "طلب توصيل خدمة كهرباء",
                requestSummary: "المنطقة التي أسكن بها تفتقد لخدمة الكهرباء منذ ثلاثة أشهر مما يسبب معاناة كبيرة للأهالي.",
                requestDate: "2023-12-15",
                category: "electricity",
                status: "pending",
                phone: "01012345678",
                address: "شارع النصر - حي الزهور",
                priority: "high",
                comments: "جاري التواصل مع شركة الكهرباء",
                createdAt: new Date().toISOString()
            },
            {
                id: 1002,
                nationalId: "29905052345678",
                applicantName: "سارة خالد حسن",
                requestTitle: "طلب إنشاء مركز صحي",
                requestSummary: "الحاجة إلى مركز صحي في الحي الجديد لخدمة أكثر من 5000 مواطن.",
                requestDate: "2023-12-10",
                category: "health",
                status: "approved",
                priority: "medium",
                phone: "01098765432",
                address: "شارع الجامعة - حي الأمل",
                comments: "تمت الموافقة على الطلب وتحويله لوزارة الصحة",
                createdAt: new Date().toISOString()
            }
        ];

        // إعدادات GitHub
        let githubConfig = JSON.parse(localStorage.getItem('githubConfig')) || {
            token: '',
            repo: 'citizen-requests-system',
            filename: 'data.json',
            autoSync: false
        };

        // المستخدم الحالي
        let currentUser = null;

        // الدوال الأساسية
        function saveRequests() {
            localStorage.setItem('citizenRequests', JSON.stringify(requests));
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ar-EG', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function getCategoryClass(category) {
            const colors = {
                electricity: 'category-badge bg-orange-100 text-orange-800 border-orange-500',
                health: 'category-badge bg-pink-100 text-pink-800 border-pink-500',
                water: 'category-badge bg-blue-100 text-blue-800 border-blue-500',
                sanitation: 'category-badge bg-purple-100 text-purple-800 border-purple-500',
                education: 'category-badge bg-green-100 text-green-800 border-green-500',
                transport: 'category-badge bg-indigo-100 text-indigo-800 border-indigo-500',
                telecom: 'category-badge bg-cyan-100 text-cyan-800 border-cyan-500',
                housing: 'category-badge bg-teal-100 text-teal-800 border-teal-500'
            };
            return colors[category] || 'category-badge bg-gray-100 text-gray-800 border-gray-500';
        }

        function getStatusClass(status) {
            const colors = {
                submitted: 'status-badge bg-blue-100 text-blue-800',
                pending: 'status-badge bg-yellow-100 text-yellow-800',
                approved: 'status-badge bg-green-100 text-green-800',
                rejected: 'status-badge bg-red-100 text-red-800'
            };
            return colors[status] || 'status-badge bg-gray-100 text-gray-800';
        }

        // تحديث لوحة التحكم
        function updateDashboard() {
            const total = requests.length;
            const newRequests = requests.filter(r => {
                const requestDate = new Date(r.requestDate);
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                return requestDate >= weekAgo;
            }).length;
            
            const pending = requests.filter(r => r.status === 'pending').length;
            const approved = requests.filter(r => r.status === 'approved').length;
            const completionRate = total > 0 ? Math.round((approved / total) * 100) : 0;
            
            $('#totalRequests').text(total);
            $('#newRequests').text(newRequests);
            $('#pendingRequests').text(pending);
            $('#completionRate').text(completionRate + '%');
            
            updateRequestsTable();
        }

        function updateRequestsTable() {
            const table = $('#requestsTable');
            table.empty();
            
            requests.slice(0, 10).forEach(request => {
                const category = systemData.categories[request.category];
                const status = systemData.statuses[request.status];
                
                const row = `
                    <tr>
                        <td>${request.id}</td>
                        <td>${request.applicantName}</td>
                        <td>${request.nationalId}</td>
                        <td>
                            <span class="${getCategoryClass(request.category)}">
                                <i class="${category.icon} me-1"></i>${category.name}
                            </span>
                        </td>
                        <td>
                            <span class="${getStatusClass(request.status)}">
                                <i class="${status.icon} me-1"></i>${status.name}
                            </span>
                        </td>
                        <td>${formatDate(request.requestDate)}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="showRequestDetails(${request.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
                
                table.append(row);
            });
        }

        function showRequestDetails(requestId) {
            const request = requests.find(r => r.id === requestId);
            if (!request) return;
            
            const category = systemData.categories[request.category];
            const status = systemData.statuses[request.status];
            
            const modalHtml = `
                <div class="modal fade" id="requestDetailsModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header" style="border-right: 5px solid ${category.color};">
                                <h5 class="modal-title">تفاصيل الطلب #${request.id}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">اسم مقدم الطلب</label>
                                            <p>${request.applicantName}</p>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">الرقم القومي</label>
                                            <p>${request.nationalId}</p>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">الهيئة الحكومية</label>
                                            <p>
                                                <span class="${getCategoryClass(request.category)}">
                                                    <i class="${category.icon} me-1"></i>${category.name}
                                                </span>
                                            </p>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">حالة الطلب</label>
                                            <p>
                                                <span class="${getStatusClass(request.status)}">
                                                    <i class="${status.icon} me-1"></i>${status.name}
                                                </span>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label fw-bold">عنوان الطلب</label>
                                    <p>${request.requestTitle}</p>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label fw-bold">وصف الطلب</label>
                                    <div class="card">
                                        <div class="card-body">
                                            ${request.requestSummary}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            $('body').append(modalHtml);
            const modal = new bootstrap.Modal(document.getElementById('requestDetailsModal'));
            modal.show();
            
            $('#requestDetailsModal').on('hidden.bs.modal', function() {
                $(this).remove();
            });
        }

        // GitHub Sync Functions
        async function testGithubConnection() {
            const token = $('#githubToken').val();
            if (!token) {
                alert('الرجاء إدخال GitHub Token');
                return;
            }
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    alert('✅ تم الاتصال بنجاح مع GitHub');
                } else {
                    throw new Error('فشل الاتصال');
                }
            } catch (error) {
                alert('❌ فشل الاتصال مع GitHub: ' + error.message);
            }
        }

        async function syncToGithub() {
            const token = $('#githubToken').val();
            const repo = $('#githubRepo').val();
            const filename = $('#githubFilename').val();
            
            if (!token || !repo) {
                alert('الرجاء إدخال GitHub Token واسم المستودع');
                return;
            }
            
            try {
                const data = {
                    requests: requests,
                    lastSync: new Date().toISOString(),
                    totalRecords: requests.length
                };
                
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Sync data at ${new Date().toLocaleString()}`,
                        content: btoa(JSON.stringify(data, null, 2)),
                        sha: await getFileSHA(token, repo, filename)
                    })
                });
                
                if (response.ok) {
                    $('#syncStatus').html(`
                        <i class="fas fa-check-circle text-success me-2"></i>
                        تم رفع ${requests.length} طلب إلى GitHub بنجاح
                    `);
                    alert('✅ تم مزامنة البيانات مع GitHub بنجاح');
                } else {
                    throw new Error('فشل رفع البيانات');
                }
            } catch (error) {
                $('#syncStatus').html(`
                    <i class="fas fa-times-circle text-danger me-2"></i>
                    فشل المزامنة: ${error.message}
                `);
                alert('❌ فشل مزامنة البيانات: ' + error.message);
            }
        }

        async function syncFromGithub() {
            const token = $('#githubToken').val();
            const repo = $('#githubRepo').val();
            const filename = $('#githubFilename').val();
            
            if (!token || !repo) {
                alert('الرجاء إدخال GitHub Token واسم المستودع');
                return;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = JSON.parse(atob(data.content));
                    
                    if (content.requests && Array.isArray(content.requests)) {
                        requests = content.requests;
                        saveRequests();
                        updateDashboard();
                        
                        $('#syncStatus').html(`
                            <i class="fas fa-check-circle text-success me-2"></i>
                            تم جلب ${requests.length} طلب من GitHub بنجاح
                        `);
                        alert('✅ تم استيراد البيانات من GitHub بنجاح');
                    } else {
                        throw new Error('تنسيق البيانات غير صحيح');
                    }
                } else {
                    throw new Error('فشل جلب البيانات');
                }
            } catch (error) {
                $('#syncStatus').html(`
                    <i class="fas fa-times-circle text-danger me-2"></i>
                    فشل الاستيراد: ${error.message}
                `);
                alert('❌ فشل استيراد البيانات: ' + error.message);
            }
        }

        async function getFileSHA(token, repo, filename) {
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${filename}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.sha;
                }
                return null;
            } catch (error) {
                return null;
            }
        }

        function saveGithubConfig() {
            githubConfig = {
                token: $('#githubToken').val(),
                repo: $('#githubRepo').val(),
                filename: $('#githubFilename').val(),
                autoSync: $('#autoSync').is(':checked')
            };
            
            localStorage.setItem('githubConfig', JSON.stringify(githubConfig));
            alert('✅ تم حفظ إعدادات GitHub');
        }

        function loadGithubConfig() {
            $('#githubToken').val(githubConfig.token);
            $('#githubRepo').val(githubConfig.repo);
            $('#githubFilename').val(githubConfig.filename);
            $('#autoSync').prop('checked', githubConfig.autoSync);
        }

        // تسجيل الدخول
        $('#loginForm').submit(function(e) {
            e.preventDefault();
            const username = $('#username').val();
            const password = $('#password').val();
            
            // مصادقة بسيطة (في تطبيق حقيقي سيتم التحقق من الخادم)
            if ((username === 'admin' && password === '123456') || 
                (username === 'user' && password === '123456')) {
                
                currentUser = { username, role: username === 'admin' ? 'admin' : 'user' };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                $('#loginPage').hide();
                $('#appContainer').show();
                
                updateDashboard();
                loadGithubConfig();
            } else {
                alert('اسم المستخدم أو كلمة المرور غير صحيحة');
            }
        });

        // عرض/إخفاء كلمة المرور
        $('#togglePassword').click(function() {
            const passwordInput = $('#password');
            const icon = $(this).find('i');
            
            if (passwordInput.attr('type') === 'password') {
                passwordInput.attr('type', 'text');
                icon.removeClass('fa-eye').addClass('fa-eye-slash');
            } else {
                passwordInput.attr('type', 'password');
                icon.removeClass('fa-eye-slash').addClass('fa-eye');
            }
        });

        // إضافة طلب جديد
        $('#addRequestBtn').click(function() {
            const modal = new bootstrap.Modal(document.getElementById('newRequestModal'));
            modal.show();
        });

        $('#submitRequestBtn').click(function() {
            const nationalId = $('#nationalId').val();
            const applicantName = $('#applicantName').val();
            const phone = $('#phone').val();
            const address = $('#address').val();
            const requestTitle = $('#requestTitle').val();
            const requestSummary = $('#requestSummary').val();
            const category = $('#category').val();
            const priority = $('#priority').val();
            
            if (!nationalId || !applicantName || !requestTitle || !category) {
                alert('الرجاء ملء جميع الحقول المطلوبة');
                return;
            }
            
            const newId = requests.length > 0 ? Math.max(...requests.map(r => r.id)) + 1 : 1001;
            
            const newRequest = {
                id: newId,
                nationalId,
                applicantName,
                phone,
                address,
                requestTitle,
                requestSummary,
                category,
                priority,
                status: 'submitted',
                requestDate: new Date().toISOString().split('T')[0],
                createdAt: new Date().toISOString()
            };
            
            requests.unshift(newRequest);
            saveRequests();
            
            // المزامنة مع GitHub إذا كانت مفعلة
            if (githubConfig.autoSync && githubConfig.token) {
                syncToGithub();
            }
            
            updateDashboard();
            alert('✅ تم إضافة الطلب الجديد بنجاح');
            
            // إغلاق النموذج وإعادة تعيين الحقول
            const modal = bootstrap.Modal.getInstance(document.getElementById('newRequestModal'));
            modal.hide();
            $('#newRequestForm')[0].reset();
        });

        // التنقل بين الصفحات
        $('[data-page]').click(function(e) {
            e.preventDefault();
            const page = $(this).data('page');
            
            $('[data-page]').removeClass('active');
            $(this).addClass('active');
            
            $('.main-content > div').hide();
            $(`#${page}Page`).show();
            
            if (page === 'githubSync') {
                loadGithubConfig();
            }
        });

        // GitHub Sync Buttons
        $('#testGithubConnection').click(testGithubConnection);
        $('#saveGithubConfig').click(saveGithubConfig);
        $('#syncToGithubBtn').click(syncToGithub);
        $('#syncFromGithubBtn').click(syncFromGithub);

        // تسجيل الخروج
        $('#logoutBtn').click(function() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                localStorage.removeItem('currentUser');
                currentUser = null;
                $('#appContainer').hide();
                $('#loginPage').show();
                $('#loginForm')[0].reset();
            }
        });

        // التحقق من تسجيل الدخول عند تحميل الصفحة
        $(document).ready(function() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                $('#loginPage').hide();
                $('#appContainer').show();
                updateDashboard();
                loadGithubConfig();
            }
        });
    </script>
</body>
</html>            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-submitted { background-color: #dbeafe; color: var(--primary-color); }
        .badge-pending { background-color: #fef3c7; color: var(--warning-color); }
        .badge-approved { background-color: #d1fae5; color: var(--success-color); }
        .badge-rejected { background-color: #fee2e2; color: var(--danger-color); }

        /* Category Badges */
        .badge-category {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            border-right: 4px solid;
        }

        .category-electricity { background-color: #ffedd5; color: #f97316; border-color: #f97316; }
        .category-health { background-color: #fce7f3; color: #ec4899; border-color: #ec4899; }
        .category-water { background-color: #e0f2fe; color: #0ea5e9; border-color: #0ea5e9; }
        .category-sanitation { background-color: #f3e8ff; color: #8b5cf6; border-color: #8b5cf6; }
        .category-education { background-color: #f0fdf4; color: #84cc16; border-color: #84cc16; }
        .category-transport { background-color: #eef2ff; color: #6366f1; border-color: #6366f1; }
        .category-telecom { background-color: #ecfeff; color: #06b6d4; border-color: #06b6d4; }
        .category-housing { background-color: #f0fdfa; color: #14b8a6; border-color: #14b8a6; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 80px;
            }
            .sidebar .menu-text {
                display: none;
            }
            .main-content {
                margin-right: 80px;
            }
        }

        /* Loading Spinner */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container d-flex align-items-center justify-content-center">
        <div class="login-card bg-white p-4">
            <div class="text-center mb-4">
                <div class="mb-3">
                    <i class="fas fa-hands-helping fa-3x text-primary"></i>
                </div>
                <h3 class="fw-bold">نظام متابعة طلبات المواطنين</h3>
                <p class="text-muted">عضو مجلس النواب</p>
            </div>
            
            <form id="loginForm">
                <div class="mb-3">
                    <label class="form-label">اسم المستخدم</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-user"></i></span>
                        <input type="text" class="form-control" id="username" required>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">كلمة المرور</label>
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-lock"></i></span>
                        <input type="password" class="form-control" id="password" required>
                        <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="rememberMe">
                    <label class="form-check-label" for="rememberMe">تذكرني</label>
                </div>
                
                <button type="submit" class="btn btn-primary w-100 py-2">
                    <i class="fas fa-sign-in-alt me-2"></i>تسجيل الدخول
                </button>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appContainer" style="display: none;">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header d-flex align-items-center justify-content-center p-3">
                <h5 class="text-white mb-0" id="appTitle">نظام الطلبات</h5>
                <button class="btn btn-sm btn-outline-light ms-2 d-none d-lg-inline" id="toggleSidebar">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="px-3 py-4">
                <div class="text-center mb-4">
                    <div class="mb-3">
                        <i class="fas fa-user-circle fa-3x text-white"></i>
                    </div>
                    <h6 class="text-white mb-1" id="userName">عضو مجلس النواب</h6>
                    <small class="text-white-50" id="userRole">المسؤول</small>
                </div>
                
                <ul class="sidebar-menu">
                    <li><a href="#" class="active" data-page="dashboard"><i class="fas fa-tachometer-alt"></i><span class="menu-text">لوحة التحكم</span></a></li>
                    <li><a href="#" data-page="requests"><i class="fas fa-list"></i><span class="menu-text">جميع الطلبات</span></a></li>
                    <li><a href="#" data-page="newRequest"><i class="fas fa-plus-circle"></i><span class="menu-text">طلب جديد</span></a></li>
                    <li><a href="#" data-page="search"><i class="fas fa-search"></i><span class="menu-text">بحث متقدم</span></a></li>
                    <li><a href="#" data-page="reports"><i class="fas fa-chart-bar"></i><span class="menu-text">التقارير</span></a></li>
                    <li><a href="#" data-page="categories"><i class="fas fa-layer-group"></i><span class="menu-text">الهيئات</span></a></li>
                    <li><a href="#" data-page="users"><i class="fas fa-users"></i><span class="menu-text">المستخدمين</span></a></li>
                    <li><a href="#" data-page="settings"><i class="fas fa-cog"></i><span class="menu-text">الإعدادات</span></a></li>
                </ul>
            </div>
            
            <div class="position-absolute bottom-0 start-0 end-0 p-3">
                <button class="btn btn-outline-light w-100" id="logoutBtn">
                    <i class="fas fa-sign-out-alt me-2"></i>
                    <span class="menu-text">تسجيل الخروج</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Top Bar -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h4 class="fw-bold mb-0" id="pageTitle">لوحة التحكم</h4>
                    <p class="text-muted mb-0" id="pageSubtitle">نظرة عامة على النظام</p>
                </div>
                <div class="d-flex align-items-center">
                    <div class="input-group" style="max-width: 300px;">
                        <input type="text" class="form-control" placeholder="بحث...">
                        <button class="btn btn-outline-primary" type="button">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <button class="btn btn-primary ms-3" id="addRequestBtn">
                        <i class="fas fa-plus me-2"></i>طلب جديد
                    </button>
                </div>
            </div>

            <!-- Page Content -->
            <div id="pageContent">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page-content fade-in">
                    <div class="row g-4 mb-4">
                        <div class="col-xl-3 col-md-6">
                            <div class="dashboard-card bg-white p-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="text-muted mb-2">إجمالي الطلبات</h5>
                                        <h2 class="fw-bold mb-0" id="totalRequests">0</h2>
                                    </div>
                                    <div class="card-icon bg-primary text-white">
                                        <i class="fas fa-file-alt"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>12%
                                    </span>
                                    <span class="text-muted">من الشهر الماضي</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6">
                            <div class="dashboard-card bg-white p-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="text-muted mb-2">طلبات جديدة</h5>
                                        <h2 class="fw-bold mb-0" id="newRequests">0</h2>
                                    </div>
                                    <div class="card-icon bg-success text-white">
                                        <i class="fas fa-plus-circle"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-success">
                                        <i class="fas fa-arrow-up me-1"></i>8%
                                    </span>
                                    <span class="text-muted">من الأسبوع الماضي</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6">
                            <div class="dashboard-card bg-white p-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="text-muted mb-2">قيد الانتظار</h5>
                                        <h2 class="fw-bold mb-0" id="pendingRequests">0</h2>
                                    </div>
                                    <div class="card-icon bg-warning text-white">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <span class="text-danger">
                                        <i class="fas fa-arrow-down me-1"></i>3%
                                    </span>
                                    <span class="text-muted">من الشهر الماضي</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6">
                            <div class="dashboard-card bg-white p-4">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h5 class="text-muted mb-2">نسبة الإنجاز</h5>
                                        <h2 class="fw-bold mb-0" id="completionRate">0%</h2>
                                    </div>
                                    <div class="card-icon bg-info text-white">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <div class="progress" style="height: 6px;">
                                        <div class="progress-bar bg-success" id="progressBar" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Requests -->
                    <div class="card border-0 shadow">
                        <div class="card-header bg-white py-3">
                            <h5 class="mb-0">الطلبات الأخيرة</h5>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th>#</th>
                                            <th>اسم مقدم الطلب</th>
                                            <th>الرقم القومي</th>
                                            <th>الهيئة</th>
                                            <th>الحالة</th>
                                            <th>التاريخ</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="recentRequestsTable">
                                        <!-- سيتم تعبئتها جافاسكريبت -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other Pages (ستتم إضافتها لاحقاً) -->
                <div id="requestsPage" class="page-content" style="display: none;">
                    <h4>جميع الطلبات</h4>
                </div>
                
                <div id="newRequestPage" class="page-content" style="display: none;">
                    <h4>طلب جديد</h4>
                </div>
                
                <div id="searchPage" class="page-content" style="display: none;">
                    <h4>بحث متقدم</h4>
                </div>
                
                <div id="reportsPage" class="page-content" style="display: none;">
                    <h4>التقارير</h4>
                </div>
                
                <div id="categoriesPage" class="page-content" style="display: none;">
                    <h4>الهيئات الحكومية</h4>
                </div>
                
                <div id="usersPage" class="page-content" style="display: none;">
                    <h4>المستخدمين</h4>
                </div>
                
                <div id="settingsPage" class="page-content" style="display: none;">
                    <h4>الإعدادات</h4>
                </div>
            </div>
        </main>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="spinner-overlay" style="display: none;">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
            <span class="visually-hidden">جاري التحميل...</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class CitizenRequestSystem {
            constructor() {
                this.initializeApp();
            }

            initializeApp() {
                this.categories = {
                    electricity: { name: 'كهرباء', color: '#f97316', icon: 'fas fa-bolt' },
                    health: { name: 'صحة', color: '#ec4899', icon: 'fas fa-hospital' },
                    water: { name: 'مياه', color: '#0ea5e9', icon: 'fas fa-tint' },
                    sanitation: { name: 'صرف صحي', color: '#8b5cf6', icon: 'fas fa-toilet' },
                    education: { name: 'تعليم', color: '#84cc16', icon: 'fas fa-graduation-cap' },
                    transport: { name: 'مواصلات', color: '#6366f1', icon: 'fas fa-bus' },
                    telecom: { name: 'اتصالات', color: '#06b6d4', icon: 'fas fa-wifi' },
                    housing: { name: 'إسكان', color: '#14b8a6', icon: 'fas fa-home' }
                };

                this.statuses = {
                    submitted: { name: 'تم التقديم', color: '#3b82f6', icon: 'fas fa-file-import' },
                    pending: { name: 'انتظار الرد', color: '#f59e0b', icon: 'fas fa-clock' },
                    approved: { name: 'موافقة', color: '#10b981', icon: 'fas fa-check-circle' },
                    rejected: { name: 'غير موافقة', color: '#ef4444', icon: 'fas fa-times-circle' }
                };

                this.currentUser = null;
                this.requests = this.loadRequests();
                this.currentPage = 'dashboard';
                
                this.setupEventListeners();
                this.checkAuthentication();
            }

            // Data Management
            loadRequests() {
                const saved = localStorage.getItem('citizenRequests');
                if (saved) {
                    return JSON.parse(saved);
                }
                
                // بيانات تجريبية
                return [
                    {
                        id: 1001,
                        nationalId: "29801011234567",
                        applicantName: "أحمد محمد علي",
                        requestTitle: "طلب توصيل خدمة كهرباء",
                        requestSummary: "المنطقة التي أسكن بها تفتقد لخدمة الكهرباء منذ ثلاثة أشهر مما يسبب معاناة كبيرة للأهالي.",
                        requestDate: "2023-12-15",
                        category: "electricity",
                        status: "pending",
                        priority: "high",
                        phone: "01012345678",
                        address: "شارع النصر - حي الزهور",
                        comments: "جاري التواصل مع شركة الكهرباء",
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 1002,
                        nationalId: "29905052345678",
                        applicantName: "سارة خالد حسن",
                        requestTitle: "طلب إنشاء مركز صحي",
                        requestSummary: "الحاجة إلى مركز صحي في الحي الجديد لخدمة أكثر من 5000 مواطن.",
                        requestDate: "2023-12-10",
                        category: "health",
                        status: "approved",
                        priority: "medium",
                        phone: "01098765432",
                        address: "شارع الجامعة - حي الأمل",
                        comments: "تمت الموافقة على الطلب وتحويله لوزارة الصحة",
                        createdAt: new Date().toISOString()
                    }
                ];
            }

            saveRequests() {
                localStorage.setItem('citizenRequests', JSON.stringify(this.requests));
            }

            // Authentication
            checkAuthentication() {
                const user = localStorage.getItem('currentUser');
                if (user) {
                    this.currentUser = JSON.parse(user);
                    this.showApp();
                } else {
                    this.showLogin();
                }
            }

            authenticate(username, password) {
                // في تطبيق حقيقي، سيتم التحقق من الخادم
                const users = {
                    admin: { password: '123456', name: 'عضو مجلس النواب', role: 'admin' },
                    assistant: { password: '123456', name: 'مساعد العضو', role: 'assistant' }
                };

                if (users[username] && users[username].password === password) {
                    this.currentUser = {
                        username: username,
                        name: users[username].name,
                        role: users[username].role
                    };
                    localStorage.setItem('currentUser', JSON.stringify(this.currentUser));
                    return true;
                }
                return false;
            }

            logout() {
                localStorage.removeItem('currentUser');
                this.currentUser = null;
                this.showLogin();
            }

            // UI Management
            showLoading(show) {
                $('#loadingSpinner').toggle(show);
            }

            showLogin() {
                $('#loginPage').show();
                $('#appContainer').hide();
            }

            showApp() {
                $('#loginPage').hide();
                $('#appContainer').show();
                this.updateUserInfo();
                this.showPage('dashboard');
            }

            updateUserInfo() {
                if (this.currentUser) {
                    $('#userName').text(this.currentUser.name);
                    $('#userRole').text(this.currentUser.role === 'admin' ? 'المسؤول' : 'المساعد');
                }
            }

            showPage(page) {
                this.currentPage = page;
                
                // تحديث القائمة الجانبية
                $('.sidebar-menu a').removeClass('active');
                $(`.sidebar-menu a[data-page="${page}"]`).addClass('active');
                
                // تحديث العنوان
                const titles = {
                    dashboard: { title: 'لوحة التحكم', subtitle: 'نظرة عامة على النظام' },
                    requests: { title: 'جميع الطلبات', subtitle: 'إدارة طلبات المواطنين' },
                    newRequest: { title: 'طلب جديد', subtitle: 'إضافة طلب جديد للمواطن' },
                    search: { title: 'بحث متقدم', subtitle: 'بحث مفصل في الطلبات' },
                    reports: { title: 'التقارير', subtitle: 'تقارير وإحصائيات النظام' },
                    categories: { title: 'الهيئات الحكومية', subtitle: 'إدارة الهيئات والجهات' },
                    users: { title: 'المستخدمين', subtitle: 'إدارة حسابات المستخدمين' },
                    settings: { title: 'الإعدادات', subtitle: 'إعدادات النظام' }
                };
                
                $('#pageTitle').text(titles[page]?.title || '');
                $('#pageSubtitle').text(titles[page]?.subtitle || '');
                
                // إخفاء جميع الصفحات
                $('.page-content').hide();
                
                // إظهار الصفحة المطلوبة
                $(`#${page}Page`).show();
                
                // تحديث محتوى الصفحة
                this.updatePageContent(page);
            }

            updatePageContent(page) {
                switch(page) {
                    case 'dashboard':
                        this.updateDashboard();
                        break;
                    case 'requests':
                        this.updateRequestsPage();
                        break;
                    // سيتم إضافة الصفحات الأخرى لاحقاً
                }
            }

            updateDashboard() {
                const total = this.requests.length;
                const newRequests = this.requests.filter(r => {
                    const requestDate = new Date(r.requestDate);
                    const weekAgo = new Date();
                    weekAgo.setDate(weekAgo.getDate() - 7);
                    return requestDate >= weekAgo;
                }).length;
                
                const pending = this.requests.filter(r => r.status === 'pending').length;
                const approved = this.requests.filter(r => r.status === 'approved').length;
                const completionRate = total > 0 ? Math.round((approved / total) * 100) : 0;
                
                $('#totalRequests').text(total);
                $('#newRequests').text(newRequests);
                $('#pendingRequests').text(pending);
                $('#completionRate').text(completionRate + '%');
                $('#progressBar').css('width', completionRate + '%');
                
                this.updateRecentRequestsTable();
            }

            updateRecentRequestsTable() {
                const table = $('#recentRequestsTable');
                table.empty();
                
                const recentRequests = this.requests.slice(0, 5);
                
                recentRequests.forEach(request => {
                    const category = this.categories[request.category];
                    const status = this.statuses[request.status];
                    
                    const row = `
                        <tr>
                            <td>${request.id}</td>
                            <td>
                                <div class="fw-bold">${request.applicantName}</div>
                                <small class="text-muted">${request.requestTitle}</small>
                            </td>
                            <td>${request.nationalId}</td>
                            <td>
                                <span class="badge-category ${this.getCategoryClass(request.category)}">
                                    <i class="${category.icon} me-1"></i>${category.name}
                                </span>
                            </td>
                            <td>
                                <span class="badge-status ${this.getStatusClass(request.status)}">
                                    <i class="${status.icon} me-1"></i>${status.name}
                                </span>
                            </td>
                            <td>${this.formatDate(request.requestDate)}</td>
                            <td>
                                <button class="btn btn-sm btn-outline-primary" onclick="app.showRequestDetails(${request.id})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                    
                    table.append(row);
                });
            }

            updateRequestsPage() {
                // سيتم تنفيذها لاحقاً
            }

            // Request Management
            addRequest(requestData) {
                const newId = this.requests.length > 0 ? 
                    Math.max(...this.requests.map(r => r.id)) + 1 : 1001;
                
                const newRequest = {
                    id: newId,
                    ...requestData,
                    status: 'submitted',
                    createdAt: new Date().toISOString()
                };
                
                this.requests.unshift(newRequest);
                this.saveRequests();
                
                // إظهار إشعار
                this.showNotification('تم إضافة الطلب الجديد بنجاح', 'success');
                
                // تحديث الصفحة
                this.updatePageContent(this.currentPage);
                
                return newRequest;
            }

            updateRequestStatus(requestId, newStatus) {
                const requestIndex = this.requests.findIndex(r => r.id === requestId);
                if (requestIndex !== -1) {
                    this.requests[requestIndex].status = newStatus;
                    this.requests[requestIndex].updatedAt = new Date().toISOString();
                    this.saveRequests();
                    
                    this.showNotification('تم تحديث حالة الطلب', 'success');
                    this.updatePageContent(this.currentPage);
                }
            }

            showRequestDetails(requestId) {
                const request = this.requests.find(r => r.id === requestId);
                if (!request) return;
                
                const category = this.categories[request.category];
                const status = this.statuses[request.status];
                
                const modal = `
                    <div class="modal fade" id="requestModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header" style="border-right: 5px solid ${category.color};">
                                    <h5 class="modal-title">تفاصيل الطلب #${request.id}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">اسم مقدم الطلب</label>
                                                <p>${request.applicantName}</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">الرقم القومي</label>
                                                <p>${request.nationalId}</p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">الهاتف</label>
                                                <p>${request.phone || 'غير محدد'}</p>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">الهيئة الحكومية</label>
                                                <p>
                                                    <span class="badge-category ${this.getCategoryClass(request.category)}">
                                                        <i class="${category.icon} me-1"></i>${category.name}
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">حالة الطلب</label>
                                                <p>
                                                    <span class="badge-status ${this.getStatusClass(request.status)}">
                                                        <i class="${status.icon} me-1"></i>${status.name}
                                                    </span>
                                                </p>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-bold">تاريخ التقديم</label>
                                                <p>${this.formatDate(request.requestDate)}</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">عنوان الطلب</label>
                                        <p>${request.requestTitle}</p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">وصف الطلب</label>
                                        <div class="card">
                                            <div class="card-body">
                                                ${request.requestSummary}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    ${request.comments ? `
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">تعليقات المتابعة</label>
                                            <div class="card">
                                                <div class="card-body bg-light">
                                                    ${request.comments}
                                                </div>
                                            </div>
                                        </div>
                                    ` : ''}
                                    
                                    ${request.address ? `
                                        <div class="mb-3">
                                            <label class="form-label fw-bold">العنوان</label>
                                            <p>${request.address}</p>
                                        </div>
                                    ` : ''}
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                                    ${request.status !== 'approved' ? `
                                        <button type="button" class="btn btn-success" onclick="app.updateRequestStatus(${request.id}, 'approved')">
                                            <i class="fas fa-check me-2"></i>موافقة
                                        </button>
                                    ` : ''}
                                    ${request.status !== 'rejected' ? `
                                        <button type="button" class="btn btn-danger" onclick="app.updateRequestStatus(${request.id}, 'rejected')">
                                            <i class="fas fa-times me-2"></i>رفض
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                $('body').append(modal);
                $('#requestModal').modal('show');
                
                $('#requestModal').on('hidden.bs.modal', function() {
                    $(this).remove();
                });
            }

            // Helper Methods
            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ar-EG', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            getCategoryClass(category) {
                return `category-${category}`;
            }

            getStatusClass(status) {
                return `status-${status}`;
            }

            showNotification(message, type = 'info') {
                // في تطبيق حقيقي، سيكون هناك نظام إشعارات متكامل
                alert(`${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'} ${message}`);
            }

            // Event Handlers
            setupEventListeners() {
                // تسجيل الدخول
                $('#loginForm').submit((e) => {
                    e.preventDefault();
                    const username = $('#username').val();
                    const password = $('#password').val();
                    
                    if (this.authenticate(username, password)) {
                        this.showApp();
                    } else {
                        alert('اسم المستخدم أو كلمة المرور غير صحيحة');
                    }
                });

                // تبديل عرض كلمة المرور
                $('#togglePassword').click(() => {
                    const passwordInput = $('#password');
                    const icon = $('#togglePassword i');
                    
                    if (passwordInput.attr('type') === 'password') {
                        passwordInput.attr('type', 'text');
                        icon.removeClass('fa-eye').addClass('fa-eye-slash');
                    } else {
                        passwordInput.attr('type', 'password');
                        icon.removeClass('fa-eye-slash').addClass('fa-eye');
                    }
                });

                // تنقل القائمة الجانبية
                $('.sidebar-menu a').click((e) => {
                    e.preventDefault();
                    const page = $(e.currentTarget).data('page');
                    this.showPage(page);
                });

                // إضافة طلب جديد
                $('#addRequestBtn').click(() => {
                    this.showNewRequestModal();
                });

                // تسجيل الخروج
                $('#logoutBtn').click(() => {
                    this.logout();
                });

                // تبديل القائمة الجانبية
                $('#toggleSidebar').click(() => {
                    $('#sidebar').toggleClass('collapsed');
                    $('#mainContent').toggleClass('expanded');
                });
            }

            showNewRequestModal() {
                const modal = `
                    <div class="modal fade" id="newRequestModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">إضافة طلب جديد</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="requestForm">
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">الرقم القومي</label>
                                                <input type="text" class="form-control" id="nationalId" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">اسم مقدم الطلب</label>
                                                <input type="text" class="form-control" id="applicantName" required>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">رقم الهاتف</label>
                                                <input type="tel" class="form-control" id="phone" required>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">العنوان</label>
                                                <input type="text" class="form-control" id="address" required>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">عنوان الطلب</label>
                                            <input type="text" class="form-control" id="requestTitle" required>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">وصف الطلب</label>
                                            <textarea class="form-control" id="requestSummary" rows="4" required></textarea>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">الهيئة الحكومية</label>
                                                <select class="form-select" id="category" required>
                                                    <option value="">اختر الهيئة...</option>
                                                    ${Object.entries(this.categories).map(([key, cat]) => 
                                                        `<option value="${key}">${cat.name}</option>`
                                                    ).join('')}
                                                </select>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <label class="form-label">أولوية الطلب</label>
                                                <select class="form-select" id="priority" required>
                                                    <option value="low">منخفض</option>
                                                    <option value="medium" selected>متوسط</option>
                                                    <option value="high">عاجل</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                                    <button type="button" class="btn btn-primary" id="submitRequestBtn">حفظ الطلب</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                $('body').append(modal);
                $('#newRequestModal').modal('show');
                
                $('#submitRequestBtn').click(() => {
                    const requestData = {
                        nationalId: $('#nationalId').val(),
                        applicantName: $('#applicantName').val(),
                        phone: $('#phone').val(),
                        address: $('#address').val(),
                        requestTitle: $('#requestTitle').val(),
                        requestSummary: $('#requestSummary').val(),
                        category: $('#category').val(),
                        priority: $('#priority').val(),
                        requestDate: new Date().toISOString().split('T')[0]
                    };
                    
                    this.addRequest(requestData);
                    $('#newRequestModal').modal('hide');
                });
                
                $('#newRequestModal').on('hidden.bs.modal', function() {
                    $(this).remove();
                });
            }
        }

        // Initialize the application
        const app = new CitizenRequestSystem();
        
        // Make app globally available for HTML event handlers
        window.app = app;
    </script>
</body>
</html>

